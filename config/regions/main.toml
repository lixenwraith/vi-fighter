# Main gameplay region states

[states.Gameplay]
parent = "Root"

# === GOLD SPAWN CYCLE ===

[states.TrySpawnGold]
parent = "Gameplay"
on_enter = [
    { action = "EmitEvent", event = "EventGoldSpawnRequest" }
]
transitions = [
    { trigger = "EventGoldSpawned", target = "GoldActive" },
    { trigger = "EventGoldSpawnFailed", target = "GoldRetryWait" }
]

[states.GoldRetryWait]
parent = "Gameplay"
transitions = [
    { trigger = "Tick", target = "TrySpawnGold", guard = "StateTimeExceeds", guard_args = { ms = 1 } }
]

[states.GoldActive]
parent = "Gameplay"
transitions = [
    { trigger = "EventGoldComplete", target = "PreSweepCheck" },
    { trigger = "EventGoldTimeout", target = "DecayWait" },
    { trigger = "EventGoldDestroyed", target = "DecayWait" }
]

# === SWEEPING EVALUATION ===

[states.PreSweepCheck]
parent = "Gameplay"
transitions = [
    { trigger = "Tick", target = "SweepingHot", guard = "StatusBoolEquals", guard_args = { key = "heat.at_max", value = true } },
    { trigger = "Tick", target = "SweepingNormal" }
]

[states.SweepingHot]
parent = "Gameplay"
on_enter = [
    { action = "EmitEvent", event = "EventCleanerSweepingRequest" }
]
transitions = [
    { trigger = "EventCleanerSweepingFinished", target = "QuasarHandoff" }
]

[states.SweepingNormal]
parent = "Gameplay"
on_enter = [
    { action = "EmitEvent", event = "EventHeatSet", payload = { value = 100 } },
    { action = "EmitEvent", event = "EventCleanerSweepingRequest" }
]
transitions = [
    { trigger = "EventCleanerSweepingFinished", target = "DecayWait" }
]

# === QUASAR HANDOFF ===

[states.QuasarHandoff]
parent = "Gameplay"
on_enter = [
    { action = "SpawnRegion", region = "quasar", initial_state = "QuasarFuse" },
    { action = "PauseRegion", region = "main" }
]
transitions = [
    { trigger = "Tick", target = "DecayWait" }
]

# === DECAY/BLOSSOM WAVES ===

[states.DecayWait]
parent = "Gameplay"
transitions = [
    { trigger = "Tick", target = "DecayAnimation", guard = "StateTimeExceeds", guard_args = { ms = 5000 } }
]

[states.DecayAnimation]
parent = "Gameplay"
on_enter = [
    { action = "EmitEvent", event = "EventDecayWave" }
]
transitions = [
    { trigger = "Tick", target = "TrySpawnGold2", guard = "StateTimeExceeds", guard_args = { ms = 3000 } }
]

[states.TrySpawnGold2]
parent = "Gameplay"
on_enter = [
    { action = "EmitEvent", event = "EventGoldSpawnRequest" }
]
transitions = [
    { trigger = "EventGoldSpawned", target = "GoldActive2" },
    { trigger = "EventGoldSpawnFailed", target = "GoldRetryWait2" }
]

[states.GoldRetryWait2]
parent = "Gameplay"
transitions = [
    { trigger = "Tick", target = "TrySpawnGold2", guard = "StateTimeExceeds", guard_args = { ms = 1 } }
]

[states.GoldActive2]
parent = "Gameplay"
transitions = [
    { trigger = "EventGoldComplete", target = "PreSweepCheck2" },
    { trigger = "EventGoldTimeout", target = "BlossomWait" },
    { trigger = "EventGoldDestroyed", target = "BlossomWait" }
]

[states.PreSweepCheck2]
parent = "Gameplay"
transitions = [
    { trigger = "Tick", target = "SweepingHot", guard = "StatusBoolEquals", guard_args = { key = "heat.at_max", value = true } },
    { trigger = "Tick", target = "SweepingNormal2" }
]

[states.SweepingNormal2]
parent = "Gameplay"
on_enter = [
    { action = "EmitEvent", event = "EventHeatSet", payload = { value = 100 } },
    { action = "EmitEvent", event = "EventCleanerSweepingRequest" }
]
transitions = [
    { trigger = "EventCleanerSweepingFinished", target = "BlossomWait" }
]

[states.BlossomWait]
parent = "Gameplay"
transitions = [
    { trigger = "Tick", target = "BlossomAnimation", guard = "StateTimeExceeds", guard_args = { ms = 5000 } }
]

[states.BlossomAnimation]
parent = "Gameplay"
on_enter = [
    { action = "EmitEvent", event = "EventBlossomWave" }
]
transitions = [
    { trigger = "Tick", target = "TrySpawnGold", guard = "StateTimeExceeds", guard_args = { ms = 3000 } }
]