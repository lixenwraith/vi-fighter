# Main region: gold cycle with escalation to quasar

[states.MainCycle]
parent = "Root"
on_exit = [
    { action = "EmitEvent", event = "EventGoldCancel" }
]
transitions = [
    { trigger = "Tick", target = "MainEscalate", guard = "StatusIntCompare", guard_args = { key = "kills.drain", op = "gte", value = 10 } }
]

# --- Gold Spawn ---

[states.MainSpawnGold]
parent = "MainCycle"
on_enter = [
    { action = "EmitEvent", event = "EventGoldSpawnRequest" }
]
transitions = [
    { trigger = "EventGoldSpawned", target = "MainGoldActive" },
    { trigger = "EventGoldSpawnFailed", target = "MainSpawnGoldRetry" }
]

[states.MainSpawnGoldRetry]
parent = "MainCycle"
transitions = [
    { trigger = "Tick", target = "MainSpawnGold", guard = "StateTimeExceeds", guard_args = { ms = 100 } }
]

# --- Gold Active ---

[states.MainGoldActive]
parent = "MainCycle"
transitions = [
    { trigger = "EventGoldCompleted", target = "MainGoldCompleted" },
    { trigger = "EventGoldTimeout", target = "MainGoldTimeout" },
    { trigger = "EventGoldDestroyed", target = "MainGoldDestroyed" }
]

[states.MainGoldCompleted]
parent = "MainCycle"
on_enter = [
    { action = "EmitEvent", event = "EventHeatAddRequest", payload = { delta = 100 } },
    { action = "EmitEvent", event = "EventEnergyAddRequest", payload = { delta = 1000, type = 1 } }
]
transitions = [
    { trigger = "Tick", target = "MainDecayWait" }
]

[states.MainGoldTimeout]
parent = "MainCycle"
transitions = [
    { trigger = "Tick", target = "MainDecayWait" }
]

[states.MainGoldDestroyed]
parent = "MainCycle"
transitions = [
    { trigger = "Tick", target = "MainDecayWait" }
]

# --- Decay Cycle ---

[states.MainDecayWait]
parent = "MainCycle"
transitions = [
    { trigger = "Tick", target = "MainDecayWave", guard = "StateTimeExceeds", guard_args = { ms = 5000 } }
]

[states.MainDecayWave]
parent = "MainCycle"
on_enter = [
    { action = "EmitEvent", event = "EventDecayWave" }
]
transitions = [
    { trigger = "Tick", target = "MainSpawnGold", guard = "StateTimeExceeds", guard_args = { ms = 5000 } }
]

# --- Escalation ---

[states.MainEscalate]
parent = "Root"
on_enter = [
    { action = "ResetStatusInt", payload = { key = "kills.drain" } },
    { action = "SpawnRegion", region = "quasar", initial_state = "QuasarFuse" },
    { action = "PauseRegion", region = "main" }
]
transitions = [
    { trigger = "Tick", target = "MainSpawnGold" }
]